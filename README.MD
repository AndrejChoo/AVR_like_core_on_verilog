Этот проект разрабатывался исключительно в развлекательных целях (да простит меня Atmel и Microchip) и спортивного интереса. Цель проекта была создать ядро AVR, которое можно программировать стандартными инструментами (AVR GCC) на языке Си, а также "заливать" прошивку без использования дополнительного оборудования (отладчиков, типа J-Link или им подобных). Также обязательным условием было использования встроенной блочной памяти без внешних Flash и Sram.

В конечном итоге (с третьей попытки) получилось родить работоспособное ядро, которое может не только помигать светодиодом, но и работать с разнообразной периферией по SPI,UART,I2C, работать с массивами в ОЗУ и всё это с использованием стандартных инструментов разработки для микроконтроллеров AVR.
Само ядро, естественно, не копирует 1 в 1 оригинал такт в такт, а только исполняет его набор инструкций. Главное основное отличие - машинный цикл (исполнение одной инструкции) выполняется за два такта (в оригинале - за 1 такт), но это легко компенсируется поддержкой более высокой входной частоты (проверено до 50MHz, что в итоге эквивалентно 25MHz оригинала). Также, благодаря использованию 2-портовой RAM и ROM памяти, удалось сократить такие команды, как PUSH, ST, STD, RCALL до одного машинного цикла, POP, RET, RETI, LD, LDD и им подобные до 2 машинных циклов (в отличии от 2 и 3 соотв. у оригинала), что очень заметно особенно при обработке прерываний (где особенно используется команд POP и PUSH при компиляции Си кода). Из нереализованных остались команды умножения с плавающей точкой (FMUL, FMULS,FMULSU). Каждая команда может быть индивидуально включена или выключена из компиляции проекта с помощью макросов.

Из периферии реализовано:
GPIO: три двунаправленных восьмиразрядных порта (PB,PC,PD).
UART: RX и TX, тоько асинхронный режим 8 бит, 1 стоп, no parity. Зато baudrate может быть значительно выше оригинала.
SPI: только MASTER 0-й и 2-й режимы, 8 бит, MSB-LSB. Максимальная частота равна 1/2 входной частоты.
I2C: тоько мастер, не реализованы статусы TWSR, добавлена возможность отслеживать ACK/NACK от слейва по дополнительному флагу.
TIMER0: функционально идентичен оригиналу.
Карта регистров совпадает с Atmega8, но есть некоторые отличия по инициализации модулей (кроме GPIO, там всё идентично оригиналу). Отличия в основном по настройке делителей частоты.
В любом случае, периферию можно реализовать свою, на любой вкус.
Также реализована система прерываний: добавлена и проверена обработка четырёх векторов (INT0, INT1, TIMER0 Overflow, USART RXC). На остальных векторах стоят заглушки, но их несложно добавить по аналогии с уже реализованными.

Работа ядра была опробована на Altera CycloneIV и Xilinx Spartan6. Также на начальных этапах проверялось на GOWIN, но ближе к финальной версии на данной платформе ядро просто перестало работать, долго не стал разбираться, почему. Так как другие мои крупные проекты, отлаженные на Альтере, также некорректно работали на Gowin. Видимо, эта китайская платформа ещё сыровата. В общем, весь проект, включая ядро, периферию, прерывания, а также дополнительно динамическую индикацию для отладки занял 5740 ячеек LUT4 (Altera), 2920 ячеек LUT5 (Xilinx). Не знаю, много это или нет? 


